<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="koggiri.approval.mapper.ApprovalMapper">
	<cache />

	
	
	<select id="appty_select" resultType="AppType">
		select app_type_cd, app_type_nm, app_context from App_type
	</select>
	
	<select id="einfo_select" parameterType="String" resultType="Emp_infomation">
		select e.emp_id as emp_id, e.emp_nm as emp_nm, e.dept_id as dept_id,
			   d.dept_nm as dept_nm, p.pos_nm as pos_nm 		
		from emp e inner join dept d
		on e.dept_id = d.dept_id
		inner join pos p
		on e.pos_id = p.pos_id
		and e.emp_id = #{emp_id}
	</select>

	<select id="approval_r_select" resultType="Approval">
		select a.app_id as app_id, a.draft_dt as draft_dt, at.app_type_nm as app_type_nm,
		       d.dept_nm as dept_nm, ed.emp_nm as draft_emp_nm , ea.emp_nm as app_emp_nm, ap.app_pro_nm as app_pro_nm 
		from approval a inner join app_type at
		on a.app_type_cd = at.app_type_cd
		inner join app_pro_type ap
		on a.app_pro_cd = ap.app_pro_cd
		inner join dept d
		on a.dept_id = d.dept_id
		inner join emp ed
		on a.draft_emp_id = ed.emp_id
		inner join emp ea
		on a.app_emp_id = ea.emp_id
	</select>
	
	<select id="approval_rw_select" resultType="Approval">
		select a.app_id as app_id, a.draft_dt as draft_dt, at.app_type_nm as app_type_nm,
		       d.dept_nm as dept_nm, ed.emp_nm as draft_emp_nm , ea.emp_nm as app_emp_nm, ap.app_pro_nm as app_pro_nm 
		from approval a inner join app_type at
		on a.app_type_cd = at.app_type_cd
		inner join app_pro_type ap
		on a.app_pro_cd = ap.app_pro_cd
		inner join dept d
		on a.dept_id = d.dept_id
		inner join emp ed
		on a.draft_emp_id = ed.emp_id
		inner join emp ea
		on a.app_emp_id = ea.emp_id
		and a.app_pro_cd = '0'
	</select>
	
	<select id="approval_rp_select" resultType="Approval">
		select a.app_id as app_id, a.draft_dt as draft_dt, at.app_type_nm as app_type_nm,
		       d.dept_nm as dept_nm, ed.emp_nm as draft_emp_nm , ea.emp_nm as app_emp_nm, ap.app_pro_nm as app_pro_nm 
		from approval a inner join app_type at
		on a.app_type_cd = at.app_type_cd
		inner join app_pro_type ap
		on a.app_pro_cd = ap.app_pro_cd
		inner join dept d
		on a.dept_id = d.dept_id
		inner join emp ed
		on a.draft_emp_id = ed.emp_id
		inner join emp ea
		on a.app_emp_id = ea.emp_id
		and a.app_pro_cd = '1'
	</select>
	
	<select id="approval_re_select" resultType="Approval">
		select a.app_id as app_id, a.draft_dt as draft_dt, at.app_type_nm as app_type_nm,
		       d.dept_nm as dept_nm, ed.emp_nm as draft_emp_nm , ea.emp_nm as app_emp_nm, ap.app_pro_nm as app_pro_nm 
		from approval a inner join app_type at
		on a.app_type_cd = at.app_type_cd
		inner join app_pro_type ap
		on a.app_pro_cd = ap.app_pro_cd
		inner join dept d
		on a.dept_id = d.dept_id
		inner join emp ed
		on a.draft_emp_id = ed.emp_id
		inner join emp ea
		on a.app_emp_id = ea.emp_id
		and a.app_pro_cd = '2'
	</select>
	
	<select id="approval_rc_select" resultType="Approval">
		select a.app_id as app_id, a.draft_dt as draft_dt, at.app_type_nm as app_type_nm,
		       d.dept_nm as dept_nm, ed.emp_nm as draft_emp_nm , ea.emp_nm as app_emp_nm, ap.app_pro_nm as app_pro_nm 
		from approval a inner join app_type at
		on a.app_type_cd = at.app_type_cd
		inner join app_pro_type ap
		on a.app_pro_cd = ap.app_pro_cd
		inner join dept d
		on a.dept_id = d.dept_id
		inner join emp ed
		on a.draft_emp_id = ed.emp_id
		inner join emp ea
		on a.app_emp_id = ea.emp_id
		and a.app_pro_cd in ('3','4')
	</select>
	
	<select id="approval_s_select" resultType="Approval">
		select a.app_id as app_id, a.draft_dt as draft_dt, at.app_type_nm as app_type_nm,
		       d.dept_nm as dept_nm, ed.emp_nm as draft_emp_nm , ea.emp_nm as app_emp_nm, ap.app_pro_nm as app_pro_nm 
		from approval a inner join app_type at
		on a.app_type_cd = at.app_type_cd
		inner join app_pro_type ap
		on a.app_pro_cd = ap.app_pro_cd
		inner join dept d
		on a.dept_id = d.dept_id
		inner join emp ed
		on a.draft_emp_id = ed.emp_id
		inner join emp ea
		on a.app_emp_id = ea.emp_id
	</select>
	
	<select id="approval_sp_select" resultType="Approval">
		select a.app_id as app_id, a.draft_dt as draft_dt, at.app_type_nm as app_type_nm,
		       d.dept_nm as dept_nm, ed.emp_nm as draft_emp_nm , ea.emp_nm as app_emp_nm, ap.app_pro_nm as app_pro_nm 
		from approval a inner join app_type at
		on a.app_type_cd = at.app_type_cd
		inner join app_pro_type ap
		on a.app_pro_cd = ap.app_pro_cd
		inner join dept d
		on a.dept_id = d.dept_id
		inner join emp ed
		on a.draft_emp_id = ed.emp_id
		inner join emp ea
		on a.app_emp_id = ea.emp_id
		and a.app_pro_cd = '1'
	</select>
	
	<select id="approval_se_select" resultType="Approval">
		select a.app_id as app_id, a.draft_dt as draft_dt, at.app_type_nm as app_type_nm,
		       d.dept_nm as dept_nm, ed.emp_nm as draft_emp_nm , ea.emp_nm as app_emp_nm, ap.app_pro_nm as app_pro_nm 
		from approval a inner join app_type at
		on a.app_type_cd = at.app_type_cd
		inner join app_pro_type ap
		on a.app_pro_cd = ap.app_pro_cd
		inner join dept d
		on a.dept_id = d.dept_id
		inner join emp ed
		on a.draft_emp_id = ed.emp_id
		inner join emp ea
		on a.app_emp_id = ea.emp_id
		and a.app_pro_cd = '2'
	</select>
	
	<select id="approval_sc_select" resultType="Approval">
		select a.app_id as app_id, a.draft_dt as draft_dt, at.app_type_nm as app_type_nm,
		       d.dept_nm as dept_nm, ed.emp_nm as draft_emp_nm , ea.emp_nm as app_emp_nm , ap.app_pro_nm as app_pro_nm 
		from approval a inner join app_type at
		on a.app_type_cd = at.app_type_cd
		inner join app_pro_type ap
		on a.app_pro_cd = ap.app_pro_cd
		inner join dept d
		on a.dept_id = d.dept_id
		inner join emp ed
		on a.draft_emp_id = ed.emp_id
		inner join emp ea
		on a.app_emp_id = ea.emp_id
		and a.app_pro_cd in ('3','4')
	</select>
	
	
	<insert id="insertApproval"  parameterType="Approval">       
    	{CALL insert_approval(#{app_type_cd}, #{draft_emp_id}, #{app_emp_id}, #{draft_dt}, #{app_title}, #{app_context})}        
	</insert>
	
	<select id="detailRApproval" parameterType="String" resultType="Approval">
		select a.app_id as app_id, at.app_type_nm as app_type_nm, d.dept_nm as dept_nm, ap.app_pro_nm as app_pro_nm, 
		       ed.emp_nm as draft_emp_nm, ea.emp_nm as app_emp_nm, a.draft_dt as draft_dt, a.app_dt as app_dt,
		       a.app_title as app_title, a.app_context as app_context
		from approval a inner join app_type at
		on a.app_type_cd = at.app_type_cd
		inner join app_pro_type ap
		on a.app_pro_cd = ap.app_pro_cd
		inner join dept d
		on a.dept_id = d.dept_id
		inner join emp ed
		on a.draft_emp_id = ed.emp_id
		inner join emp ea
		on a.app_emp_id = ea.emp_id
		and a.app_id = #{app_id}
	</select>

	<select id="detailSApproval" parameterType="String" resultType="Approval">
		select a.app_id as app_id, at.app_type_nm as app_type_nm, d.dept_nm as dept_nm, ap.app_pro_nm as app_pro_nm, 
		       ed.emp_nm as draft_emp_nm, ea.emp_nm as app_emp_nm, a.draft_dt as draft_dt, a.app_dt as app_dt,
		       a.app_title as app_title, a.app_context as app_context
		from approval a inner join app_type at
		on a.app_type_cd = at.app_type_cd
		inner join app_pro_type ap
		on a.app_pro_cd = ap.app_pro_cd
		inner join dept d
		on a.dept_id = d.dept_id
		inner join emp ed
		on a.draft_emp_id = ed.emp_id
		inner join emp ea
		on a.app_emp_id = ea.emp_id
		and a.app_id = #{app_id}
	</select>
	
	<update id="updateApproval_app" parameterType="Approval" >
	update approval set app_pro_cd = #{app_pro_cd} where app_id = #{app_id}
	</update>


</mapper>